<div class="space-y-6">
  <nav>
    <ol id="rounds-list" class="flex justify-center gap-2 text-xs">
      <li :for={number <- @rounds}>
        <.link
          patch={~p"/#{number}"}
          class={[
            "px-2 py-1",
            (number == @round.id && "ring-2 ring-black bg-black text-white") ||
              "bg-gray-200 text-gray-600"
          ]}
        >
          <%= number %>
        </.link>
      </li>
    </ol>
  </nav>

  <div class="bg-zinc-50">
    <img class="w-full" src={@round.image_url} alt="Guess the model, make, and year" />
  </div>

  <.simple_form
    for={@form}
    id="guess-attempt-form"
    phx-submit="guess"
    phx-change="validate"
    phx-hook="Form"
    class="flex flex-col space-y-6"
  >
    <div class="flex gap-x-2">
      <.field field={@form[:make]} solved={elem(@progress, 1)} w="w-5/12" placeholder="Make" />
      <.field field={@form[:model]} solved={elem(@progress, 2)} w="w-5/12" placeholder="Model" />
      <.field
        field={@form[:year]}
        solved={elem(@progress, 3)}
        type="number"
        w="w-2/12"
        placeholder="Year"
      />
    </div>

    <%= if solved?(@progress) do %>
      <button
        type="button"
        disabled
        class="flex w-full justify-center gap-1 bg-emerald-300 px-5 py-2 text-xl font-medium text-emerald-900"
      >
        Correct!
        <svg
          class="size-6 translate-y-[2px]"
          viewBox="0 0 28 28"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path d="M9.00781 5.8584C9.3418 5.7793 9.5791 5.42773 9.5 5.10254L8.98145 2.68555C8.90234 2.34277 8.56836 2.13184 8.22559 2.20215C7.88281 2.26367 7.6543 2.60645 7.72461 2.94922L8.25195 5.35742C8.32227 5.7002 8.65625 5.9375 9.00781 5.8584ZM5.58887 6.79883C5.84375 7.04492 6.24805 7.04492 6.48535 6.79883C6.72266 6.54395 6.73145 6.14844 6.48535 5.90234L4.72754 4.14453C4.47266 3.88965 4.08594 3.89844 3.83984 4.14453C3.58496 4.39941 3.57617 4.78613 3.83984 5.04102L5.58887 6.79883ZM13.1387 6.40332C13.0068 6.53516 12.9014 6.68457 12.8398 6.84277C12.1016 6.33301 11.2402 6.4209 10.5635 7.08887C10.3262 7.32617 10.1855 7.61621 10.1592 7.92383C9.41211 7.42285 8.58594 7.48438 7.94434 8.12598C7.3291 8.74121 7.25879 9.58496 7.74219 10.3232C7.45215 10.3408 7.17969 10.4814 6.96875 10.6836C6.24805 11.4043 6.26563 12.3887 6.99512 13.127L7.5752 13.6982C7.27637 13.707 6.96875 13.8564 6.73145 14.0938C6.01953 14.8057 6.0459 15.8428 6.81055 16.5986L12.251 22.0391C14.6504 24.4473 17.498 24.9307 19.959 23.6211C21.4531 23.5684 22.9209 22.9004 24.1953 21.6348C26.498 19.332 26.8848 16.4756 25.3203 13.1973L23.3164 8.96973C22.9209 8.15234 22.2705 7.66895 21.4795 7.67773C21.0488 7.67773 20.3105 7.90625 20.0029 8.58301C19.3789 8.1875 18.6055 8.24023 18.0166 8.71484L15.7227 6.4209C14.9229 5.62109 13.9209 5.64746 13.1387 6.40332ZM17.9199 11.8789L13.8242 7.7832C13.8506 7.69531 13.9033 7.60742 13.9736 7.52832C14.2197 7.29102 14.5537 7.30859 14.8086 7.55469L17.4189 10.1738C17.4365 10.332 17.4805 10.4902 17.542 10.6484L18.0254 11.7998C18.0342 11.835 18.0342 11.8613 18.0166 11.8877C17.9814 11.9141 17.9463 11.9053 17.9199 11.8789ZM4.68359 9.80469C5.01758 9.875 5.36035 9.65527 5.42188 9.3125C5.49219 8.96973 5.28125 8.64453 4.93848 8.57422L2.5127 8.04688C2.14355 7.96777 1.80078 8.20508 1.74805 8.57422C1.7041 8.9082 1.91504 9.22461 2.24902 9.29492L4.68359 9.80469ZM20.6445 21.248C18.4209 23.4717 15.6436 23.4189 13.1475 20.9229L7.93555 15.7109C7.69824 15.4736 7.68066 15.1572 7.90918 14.9287C8.1377 14.7002 8.46289 14.7002 8.7002 14.9375L11.8994 18.1367C12.1719 18.4092 12.5762 18.3828 12.8223 18.1367C13.0771 17.8818 13.1035 17.4688 12.8398 17.2051L8.03223 12.4062C7.80371 12.1689 7.78613 11.8525 8.01465 11.624C8.24316 11.3955 8.56836 11.3955 8.80566 11.6328L13.2793 16.1064C13.5518 16.3789 13.9561 16.3525 14.2021 16.1064C14.457 15.8516 14.4834 15.4473 14.2197 15.1748L8.95508 9.91016C8.71777 9.68164 8.70898 9.34766 8.9375 9.11914C9.15723 8.89941 9.48242 8.9082 9.71973 9.14551L14.9053 14.3311C15.1689 14.5859 15.5732 14.5771 15.8281 14.3223C16.083 14.0674 16.1006 13.6543 15.8457 13.3906L11.4424 8.99609C11.2051 8.75879 11.2051 8.44238 11.4248 8.21387C11.6533 7.98535 11.9785 7.99414 12.207 8.22266L18.4121 14.4189C18.7637 14.7793 19.2031 14.7529 19.4932 14.4541C19.748 14.208 19.8535 13.8652 19.6689 13.3906L18.5615 10.4902C18.4297 10.1387 18.5615 9.85742 18.8252 9.73438C19.1152 9.60254 19.3877 9.73438 19.5547 10.1035L21.5938 14.4453C22.9385 17.3281 22.4551 19.4375 20.6445 21.248ZM22.8682 13.8389L20.9873 9.89258C20.9697 9.81348 20.9521 9.74316 20.9521 9.65527C20.9521 9.3916 21.1631 9.14551 21.4971 9.14551C21.7168 9.14551 21.9277 9.29492 22.042 9.54102L24.0371 13.8037C25.3906 16.6777 24.9072 18.7959 23.0967 20.5977C23.0527 20.6504 23 20.6943 22.9473 20.7471C24.1162 18.752 24.0986 16.4316 22.8682 13.8389Z" />
        </svg>
      </button>
    <% else %>
      <button
        type="submit"
        class="flex w-full justify-center bg-zinc-700 px-5 py-2 text-xl font-medium text-zinc-50"
      >
        <span class="pr-1">Guess</span>
        <svg
          class="size-6 translate-y-[3px] fill-white"
          viewBox="0 0 28 28"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path d="M10.5195 21.5557C11.0908 21.5557 11.4688 21.1689 11.4688 20.624C11.4688 20.3428 11.3545 20.1318 11.1875 19.9561L8.91992 17.75L7.37305 16.4492L9.41211 16.5371H20.3896C22.5869 16.5371 23.5186 15.5439 23.5186 13.3906V8.17871C23.5186 5.98145 22.5869 5.0498 20.3896 5.0498H15.5117C14.9404 5.0498 14.5361 5.48047 14.5361 6.00781C14.5361 6.53516 14.9316 6.96582 15.5117 6.96582H20.3457C21.2422 6.96582 21.6201 7.34375 21.6201 8.23145V13.3291C21.6201 14.2344 21.2334 14.6123 20.3457 14.6123H9.41211L7.37305 14.709L8.91992 13.3994L11.1875 11.1934C11.3545 11.0264 11.4688 10.8154 11.4688 10.5254C11.4688 9.98047 11.0908 9.59375 10.5195 9.59375C10.2822 9.59375 10.0186 9.69922 9.8252 9.89258L4.78027 14.8584C4.57812 15.0518 4.47266 15.3154 4.47266 15.5791C4.47266 15.834 4.57812 16.0977 4.78027 16.291L9.8252 21.2656C10.0186 21.4502 10.2822 21.5557 10.5195 21.5557Z" />
        </svg>
      </button>
    <% end %>
  </.simple_form>

  <%= if solved?(@progress) do %>
    <div class="mt-2 flex flex-wrap items-center justify-center text-zinc-900">
      <p class="text-3xl">Correct!</p>
      <p class="basis-full text-center text-sm uppercase text-zinc-600">
        <%= @round.make %> <%= @round.model %> <%= @round.year_start %>â€“<%= @round.year_end %>
      </p>
    </div>
  <% end %>

  <div id="guesses" class="uppercase" phx-update="stream">
    <%= for {dom_id, outcome} <- @streams.outcomes do %>
      <.guess id={dom_id} outcome={outcome} />
    <% end %>
  </div>
</div>
